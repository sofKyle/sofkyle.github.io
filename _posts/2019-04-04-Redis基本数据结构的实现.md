---
layout: post
title: Redis基本数据结构的实现
tags: [Redis, ]

---

# 简单动态字符串（SDS - Simple Dynamic String）
也就是我们常说的Redis中的String类型，它的数据结构为：  
```C
struct sdshdr {
    // 标识当前字符串的实际长度  
    int len;

    // 标识剩余空间
    int free;

    // 存储字符数据的char数组
    char buf[];
}
```  

基于这种设计的SDS有如下特性：  
+ 记录了字符串长度，获取字符串长度的复杂度为O(1)  
+ 通过**预分配**策略，杜绝了缓冲区溢出  
+ 通过**预分配**和**惰性空间释放**策略减少了修改字符串时带来的内存重分配次数  
+ 二进制安全，可以保存图片、音频、视频、压缩文件等二进制数据  



# 链表（List）
Redis实现的链表有如下特性：  
+ 双端  
+ 无环  
+ 带链头指针和链尾指针  
+ 带链表长度计数器  
+ 链节点使用void*指针来保存节点值，可以保存各种不同数据类型的值  

其数据结构如下：  
```C
typedef struct listNode {
    // 前置节点
    struct listNode* prev;

    // 后置节点
    struct listNode* next;

    // 节点值
    void* value;
} listNode;

typedef struct list {
    // 链头节点
    listNode* head;

    // 链尾节点
    listNode* tail;

    // 节点数量
    unsigned long len;

    // 节点值复制函数
    void* (*dup)(void* ptr);

    // 节点释放函数
    void (*free)(void* ptr);

    // 节点值比对函数
    int (*match)(void *ptr, void* key);
} list;
```