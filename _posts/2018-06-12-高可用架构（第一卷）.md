---
layout: post
title: 高可用架构（第一卷）
tags: [阅读, ]

---

首先，感谢公司建立的产研书吧，让产品和研发部门的小伙伴能够有更好的机会读一些好书，提升自己专业技能的同时，也让我们时刻保持向上学习的动力。

此外，感谢HRBP小伙伴，让我有机会在阅读之后，发表一些个人的拙见。

我觉得读的书，从个人目的上可以大致分为两类：一类是用以解决当下的困惑，另一类则是用以开拓眼界。开始我想阅读这本《高可用架构》的时候，我是抱着后一种目的的。我希望能从这本书中汲取些比较实用的架构思想，用以帮助自己找到一些灵感去开拓成长为架构师的路。

这本书是个合集，它辑录了很多知名互联网公司专家的技术分享与交流。从日志系统、IM系统的基本架构，到高可用架构、分布式系统的实践，以及容器、大数据相关的架构设计均有涉猎。

这些内容按道理说来就是我要寻找灵感的地方，但是平心而论，却又是我当前能力所不能及的地方。

所不能及的主要有两点：知识的广度与深度。书中大大小小50来个架构案例，如果没有足够多的知识储备、亲手实践过其中的某一部分内容，是无法体会其中的精髓的。譬如，在讲雪球的IM系统架构的时候，文中介绍到，雪球的IM系统通过Netty+自定义网络协议的方式进行消息的网络传输，然后客户端用Akka做消息同步。在这个过程中，他们遇到了这样的问题：当Akka处理达到峰值时，它自带的Log Adapter阻塞会造成GC颠簸。于是他们想了个办法绕过了Akka自带的Log Adapter，转用Logback。我很好奇他们是怎么绕过的。又比如在介绍百姓网的亿级规模Elasticsearch优化实战的时候，选择G1还是CMS作为JVM的垃圾回收器，如何设置JVM参数，这些都有讲究。我还了解到了JVM 32G现象：当JVM堆大小超过32G时，哪怕用更多的内存，效果都不如31G。这些需要讲究的地方，如果没有充足的实践，是没法得到结论的。如果没有充足的实践，也不足以对技术有更深刻的理解。

书中还有章节对MySQL的优化提出了些规范，譬如索引的规范：
+ 单个索引字段数不超过5，单表索引数量不超过5，索引设计遵循B+Tree索引最左前缀匹配原则
+ 选择区分度高的列作为索引
+ 建立的索引能覆盖80%主要的查询
+ 避免索引的隐式转换
+ 避免冗余索引

当然，索引的优化可能不止这些，但是我看到这的时候，又警醒了自己一遍：索引是把双刃剑。

除此之外，书中还有章节介绍NoSQL的发展历史。在了解到了NoSQL的发展史之后，我丝毫不会再去疑惑“NoSQL是否会最终替代RDB”这样的问题。NoSQL和RDB都有各自适合的场景，我觉得学会根据现实状况做取舍是成长为架构师的第一步。

总而言之，书中所包含内容颇丰，具体涉及到架构案例的章节，也有足够的深度与广度。所以我觉得这本书不适合用来“找灵感”，倒更适合于在具体实践某种架构方案的时候，掌握一些他人已实践过的可能性。

下面说点题外话。《极客与团队》一书里面提到，程序员之间其实是需要多多交流的，因为单打独斗不光是增加了自己失败的风险，而且浪费了自己成长的可能性。因为我们无法知道，我们自己选的路是不是对的。所以，我们要适当的把自己的问题暴露出来。我希望能有更多小伙伴参与到书吧的分享活动中来，一起来分享自己的学习、读书心得。

最后的最后，让我用《高可用架构》里面的一碗毒鸡汤来结束我的这次分享，与诸君共勉：
+ 不要奢望其他人会写出高质量的代码。
+ 不要以为自己写出来的是高质量的代码。